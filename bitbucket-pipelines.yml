image: node:20

pipelines:
  branches:
    main:
      - step:
          name: Upload image to Digital Ocean
          script:
            - export BITBUCKET_COMMIT_SHORT=$(echo $BITBUCKET_COMMIT | cut -c1-7)
            - export IMAGE_NAME=jerrypolarlabs/polarlabs_homepage:$BITBUCKET_COMMIT_SHORT
            - docker build -t $IMAGE_NAME .
            - docker login registry.digitalocean.com -u $CONTAINER_REGISTRY_USERNAME -p $CONTAINER_REGISTRY_PASSWORD
            - docker push $IMAGE_NAME
          services:
            - docker

  pull-requests:
    '**':
      # - step:
      #     name: Test
      #     caches:
      #       - node
      #     script:
      #       - npm install
      #       - npm test
      - step:
          name: Code linting
          script:
            - npm install eslint
            - npx eslint .
          caches:
            - node
